<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>CraftNet Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
<style>
:root{--bg:#1e1e1e;--panel:#333;--green:#5da03b;--dirt:#866043;--admin:#b04bff;}
body{margin:0;font-family:'VT323',monospace;background:var(--bg);color:white;display:flex;height:100vh;overflow:hidden;}
.hidden{display:none!important;}
/* SIDEBAR */
#sidebar{width:200px;background:#222;border-right:4px solid #000;display:flex;flex-direction:column;z-index:10;padding:10px;}
#sidebar h3{margin:10px 0;text-align:center;}
.menu-item{padding:8px;margin:4px 0;background:#333;border:2px solid #000;cursor:pointer;text-align:center;}
.menu-item:hover{background:#444;}
.menu-item.admin{background:#b04bff;color:white;}
/* MAIN AREA */
#main-area{flex:1;overflow-y:auto;padding:10px;background:var(--panel);}
.post{background:#444;border:3px solid #000;margin-bottom:15px;}
.post-header{background:#555;padding:10px;display:flex;align-items:center;gap:10px;}
.post-body{padding:10px;font-size:1.4rem;}
.post-footer{background:#222;padding:8px;display:flex;gap:15px;font-size:1rem;}
.username{cursor:pointer;color:var(--green);}
.admin-badge{background:var(--admin);padding:2px 6px;border:2px solid #000;font-size:.6rem;}
.comment-box{background:#222;border-top:1px solid #444;padding:5px;}
.comment{font-size:1.1rem;margin:3px 0;}
.comment b{color:var(--green);}
textarea,input{width:100%;box-sizing:border-box;padding:6px;margin:4px 0;background:#000;color:#3f3;border:2px solid #555;font-family:'VT323'}
.btn{padding:8px;margin-top:4px;width:100%;cursor:pointer;background:#aaa;border:2px solid #000;font-family:'Press Start 2P';font-size:.6rem;}
.btn-green{background:var(--green);color:white;}
.profile img{width:80px;border:3px solid #000;margin-bottom:10px;}
.friend-request{display:flex;justify-content:space-between;margin:4px 0;padding:2px;border-bottom:1px solid #555;}
.friend-request button{cursor:pointer;background:#b00;color:white;border:none;padding:2px 4px;font-size:.7rem;}
.friend-chat{background:#222;border:2px solid #000;padding:5px;margin-bottom:5px;max-height:150px;overflow-y:auto;}
.friend-msg{margin:2px 0;}
.friend-msg b{color:var(--green);}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
<h3>CRAFTNET</h3>
<div class="menu-item" onclick="showHome()">Home</div>
<div class="menu-item" onclick="showFriendRequests()">Freundesanfragen</div>
<div class="menu-item" onclick="showFriendChat()">Freunde / Chat</div>
<div class="menu-item" onclick="showProfilePanel()">Profil</div>
<div id="admin-menu" class="menu-item admin hidden" onclick="showAdminPanel()">Admin: Nutzer l√∂schen</div>
</div>

<!-- MAIN AREA -->
<div id="main-area"></div>

<!-- LOGIN -->
<div id="auth-modal" class="modal">
    <div class="card">
        <h2 id="auth-title" style="font-family:'Press Start 2P';font-size:.8rem">LOGIN</h2>
        <div id="auth-error" class="error hidden"></div>
        <input id="auth-user" placeholder="Name">
        <input id="auth-pass" type="password" placeholder="Passwort (min.4)">
        <input id="auth-skin" class="hidden" placeholder="MC-Name oder Bild-URL">
        <button class="btn btn-green" onclick="handleAuth()">WELT BETRETEN</button>
        <p id="toggle-auth" style="cursor:pointer;font-size:.8rem" onclick="toggleAuthMode()">Noch kein Account? Registrieren</p>
    </div>
</div>

<script>
const ADMIN_USERS=["Mauvi_"];
let isLoginMode=true,currentUser=null;
let users=JSON.parse(localStorage.getItem("cn_users")||"{}");
let posts=JSON.parse(localStorage.getItem("cn_posts")||[]);
let friendRequests=JSON.parse(localStorage.getItem("cn_friendRequests")||"{}");
let messages=JSON.parse(localStorage.getItem("cn_messages")||"{}");

const el=id=>document.getElementById(id);
const isAdmin=u=>ADMIN_USERS.includes(u);
function save(){localStorage.setItem("cn_users",JSON.stringify(users));localStorage.setItem("cn_posts",JSON.stringify(posts));localStorage.setItem("cn_friendRequests",JSON.stringify(friendRequests));localStorage.setItem("cn_messages",JSON.stringify(messages));}

/* ===== AUTH ===== */
function toggleAuthMode(){isLoginMode=!isLoginMode;el("auth-title").innerText=isLoginMode?"LOGIN":"REGISTRIEREN";el("auth-skin").classList.toggle("hidden",isLoginMode);el("toggle-auth").innerText=isLoginMode?"Noch kein Account? Registrieren":"Bereits ein Account? Login";}
function showError(msg){el("auth-error").innerText=msg;el("auth-error").classList.remove("hidden");}
function handleAuth(){
    const n=el("auth-user").value.trim(), p=el("auth-pass").value, s=el("auth-skin").value.trim();
    if(!n||p.length<4)return showError("Name & Passwort n√∂tig!");
    if(isLoginMode){
        if(users[n]&&users[n].pass===p) loginUser(n); else showError("Falsche Daten!");
    }else{
        if(users[n]) return showError("Name vergeben!");
        users[n]={pass:p,skin:s.includes("http")?s:`https://minotar.net/avatar/${s||n}`,bio:"",status:"Hey üëã",friends:[]};
        save();alert("Registriert! Jetzt einloggen.");toggleAuthMode();
    }
}
function loginUser(n){
    currentUser=n;
    el("auth-modal").classList.add("hidden");
    if(isAdmin(n)) el("admin-menu").classList.remove("hidden");
    showHome();
}

/* ===== POSTS ===== */
function createPost(){
    const text=prompt("Post Text:"), img=prompt("Bild URL (optional):")||"", video=prompt("YouTube URL (optional):");
    if(!text)return;
    const vid=video.match(/(?:v=|\.be\/)([^&]+)/);
    posts.unshift({id:Date.now(),author:currentUser,text,video:vid?vid[1]:null,img,likes:[],comments:[]});
    save(); showHome();
}
function likePost(id){const post=posts.find(p=>p.id===id);if(post.likes.includes(currentUser))return;post.likes.push(currentUser);save();showHome();}
function addComment(id){const c=prompt("Kommentar:");if(!c)return;posts.find(p=>p.id===id).comments.push({u:currentUser,t:c});save();showHome();}
function deletePost(id){posts=posts.filter(p=>p.id!==id);save();showHome();}

/* ===== FRIEND SYSTEM ===== */
function sendFriendRequest(u){if(!friendRequests[u]) friendRequests[u]=[]; if(friendRequests[u].includes(currentUser)) return alert("Anfrage schon gesendet!"); friendRequests[u].push(currentUser); save();alert("Freundesanfrage gesendet!");}
function respondFriendRequest(u,accept){friendRequests[currentUser]=friendRequests[currentUser].filter(f=>f!==u); if(accept){users[currentUser].friends.push(u); users[u].friends.push(currentUser);} save(); showFriendRequests();}

/* ===== VIEWS ===== */
function showHome(){
    el("main-area").innerHTML="";
    posts.forEach(p=>{
        el("main-area").innerHTML+=`<div class="post">
        <div class="post-header"><img class="avatar" src="${users[p.author].skin}"><b class="username">${p.author}</b>${isAdmin(p.author)?' <span class="admin-badge">ADMIN</span>':''}</div>
        <div class="post-body">${p.text}</div>
        ${p.video?`<iframe style="width:100%;height:200px;" src="https://www.youtube.com/embed/${p.video}" frameborder="0" allowfullscreen></iframe>`:""}
        ${p.img?`<img src="${p.img}" style="width:100%;max-height:200px;object-fit:contain">`:""}
        <div class="post-footer"><span onclick="likePost(${p.id})" style="cursor:pointer">‚õèÔ∏è${p.likes.length}</span> <span onclick="addComment(${p.id})" style="cursor:pointer">üí¨${p.comments.length}</span></div>
        </div>`;
    });
}

function showProfilePanel(){
    const u=users[currentUser];
    el("main-area").innerHTML=`<div class="profile"><img src="${u.skin}"><h2>${currentUser}</h2>
    <textarea onchange="users['${currentUser}'].bio=this.value;save()">${u.bio}</textarea>
    <input value="${u.status}" onchange="users['${currentUser}'].status=this.value;save()">
    </div>`;
}

function showFriendRequests(){
    el("main-area").innerHTML="<h3>Freundesanfragen</h3>";
    const reqs=friendRequests[currentUser]||[];
    if(reqs.length===0) el("main-area").innerHTML+="Keine Anfragen.";
    reqs.forEach(u=>{
        const div=document.createElement("div"); div.className="friend-request";
        div.innerHTML=`${u} <button onclick="respondFriendRequest('${u}',true)">‚úÖ</button> <button onclick="respondFriendRequest('${u}',false)">‚ùå</button>`;
        el("main-area").appendChild(div);
    });
}

function showFriendChat(){
    el("main-area").innerHTML="<h3>Freunde Chat</h3>";
    const f=users[currentUser].friends||[];
    if(f.length===0){el("main-area").innerHTML+="Keine Freunde.";} 
    f.forEach(fr=>{
        const div=document.createElement("div"); div.className="friend-chat";
        div.innerHTML=`<b>${fr}</b><br>${(messages[fr+'_'+currentUser]||[]).map(m=>`<div class="friend-msg"><b>${m.from}:</b> ${m.text}</div>`).join("")}`;
        const btn=document.createElement("button"); btn.textContent="Nachricht senden";
        btn.onclick=()=>{const t=prompt("Text:"); if(!t)return; if(!messages[currentUser+'_'+fr]) messages[currentUser+'_'+fr]=[]; messages[currentUser+'_'+fr].push({from:currentUser,text:t}); save(); showFriendChat();};
        div.appendChild(btn);
        el("main-area").appendChild(div);
    });
}

/* ===== ADMIN PANEL ===== */
function showAdminPanel(){
    el("main-area").innerHTML="<h3>Admin: Nutzer l√∂schen</h3>";
    Object.keys(users).forEach(u=>{
        if(u===currentUser)return;
        const div=document.createElement("div");
        div.className="friend-request";
        div.innerHTML=`${u} <button onclick="deleteUser('${u}')">üóë</button>`;
        el("main-area").appendChild(div);
    });
}
function deleteUser(u){
    if(!isAdmin(currentUser)||ADMIN_USERS.includes(u)) return alert("Nicht erlaubt!");
    delete users[u];
    posts=posts.filter(p=>p.author!==u);
    if(friendRequests[u]) delete friendRequests[u];
    Object.keys(friendRequests).forEach(k=>friendRequests[k]=friendRequests[k].filter(f=>f!==u));
    save(); showAdminPanel();
}
</script>
</body>
</html>
