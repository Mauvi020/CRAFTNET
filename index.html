<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>CraftNet – Fix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#1e1e1e;color:white;font-family:monospace}
.hidden{display:none}
button{padding:10px;margin-top:10px;font-size:16px;cursor:pointer}
input{padding:8px;width:100%;margin-top:5px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center}
.card{background:#333;padding:20px;border:2px solid #000;width:300px}
header{background:#444;padding:10px}
.container{padding:15px}
.post{background:#333;padding:10px;margin-bottom:10px}
.error{background:#ffaaaa;color:#900;padding:6px;margin-bottom:6px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginModal" class="modal">
  <div class="card">
    <h3>Login / Register</h3>
    <div id="error" class="error hidden"></div>
    <input id="username" placeholder="Name">
    <input id="password" type="password" placeholder="Passwort (min.4)">
    <button id="loginBtn">Beitreten</button>
  </div>
</div>

<header>
  <b>CRAFTNET</b>
</header>

<div id="app" class="container hidden">
  <div class="post">
    <textarea id="postText" placeholder="Was gibt's Neues?" style="width:100%"></textarea>
    <button id="postBtn">Posten</button>
  </div>
  <div id="feed"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  // STATE
  let users = JSON.parse(localStorage.getItem("users") || "{}");
  let posts = JSON.parse(localStorage.getItem("posts") || "[]");
  let currentUser = null;

  // ELEMENTE
  const loginModal = document.getElementById("loginModal");
  const loginBtn   = document.getElementById("loginBtn");
  const errorBox   = document.getElementById("error");
  const app        = document.getElementById("app");
  const feed       = document.getElementById("feed");

  const save = () => {
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("posts", JSON.stringify(posts));
  };

  const showError = msg => {
    errorBox.textContent = msg;
    errorBox.classList.remove("hidden");
  };

  // LOGIN (FIXED)
  loginBtn.addEventListener("click", () => {
    const name = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value;

    errorBox.classList.add("hidden");

    if (!name || pass.length < 4) {
      showError("Name & Passwort nötig");
      return;
    }

    // Auto-Registrierung
    if (!users[name]) {
      users[name] = { pass };
      save();
    }

    if (users[name].pass !== pass) {
      showError("Falsches Passwort");
      return;
    }

    // LOGIN OK
    currentUser = name;
    loginModal.classList.add("hidden");
    app.classList.remove("hidden");
    renderFeed();
  });

  // POSTEN
  document.getElementById("postBtn").addEventListener("click", () => {
    const text = document.getElementById("postText").value.trim();
    if (!text) return;
    posts.unshift({ user: currentUser, text });
    document.getElementById("postText").value = "";
    save();
    renderFeed();
  });

  function renderFeed(){
    feed.innerHTML = "";
    posts.forEach(p => {
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `<b>${p.user}</b><br>${p.text}`;
      feed.appendChild(div);
    });
  }

});
</script>

</body>
</html>
