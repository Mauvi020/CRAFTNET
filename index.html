<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>CraftNet Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">

<style>
:root{--bg:#1e1e1e;--panel:#333;--green:#5da03b;--dirt:#866043;}
body{margin:0;background:var(--bg);color:white;font-family:'VT323',monospace;}
.hidden{display:none!important;}
header{background:var(--dirt);border-bottom:4px solid #000;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;}
.header-title{cursor:pointer;color:#3f3;font-family:'Press Start 2P';}
.avatar{width:40px;height:40px;border:2px solid #000;image-rendering:pixelated;}
.container{max-width:700px;margin:20px auto;padding:0 10px}

.post{background:var(--panel);border:3px solid #000;margin-bottom:20px}
.post-header{background:#444;padding:10px;display:flex;gap:10px;align-items:center}
.post-body{padding:15px;font-size:1.5rem}
.post-footer{background:#222;padding:10px;display:flex;gap:15px;font-size:1rem}
.username{cursor:pointer;color:var(--green)}

.comment-box{background:#222;border-top:1px solid #444;padding:8px}
.comment b{color:var(--green)}

.profile{background:#444;border:3px solid #000;padding:20px;text-align:center}
.profile img{width:96px;border:3px solid #000}

input,textarea{width:100%;padding:8px;margin:6px 0;background:#000;color:#3f3;border:2px solid #555;font-family:'VT323'}
.btn{width:100%;padding:10px;margin-top:8px;border:2px solid #000;cursor:pointer;background:#aaa;font-family:'Press Start 2P';font-size:.6rem}
.btn-green{background:var(--green);color:white}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;z-index:1000}
.card{background:#8b8b8b;border:4px solid #000;padding:20px;width:360px;text-align:center}
.error{background:#ffaaaa;color:#900;border:2px solid #000;padding:5px;margin-bottom:5px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="auth-modal" class="modal">
<div class="card">
<h2 style="font-family:'Press Start 2P';font-size:.8rem">LOGIN</h2>
<div id="auth-error" class="error hidden"></div>
<input id="auth-user" placeholder="Name">
<input id="auth-pass" type="password" placeholder="Passwort (min.4)">
<input id="auth-skin" class="hidden" placeholder="MC-Name oder Bild-URL">
<button class="btn btn-green" onclick="handleAuth()">WELT BETRETEN</button>
<p id="toggle-auth" style="cursor:pointer;font-size:.8rem" onclick="toggleAuthMode()">Noch kein Account? Registrieren</p>
</div>
</div>

<header>
<div class="header-title" onclick="openMainMenu()">CRAFTNET</div>
<div id="nav-info" class="hidden" style="display:flex;gap:10px;align-items:center">
<span id="nav-name"></span>
<img id="nav-avatar" class="avatar">
</div>
</header>

<div id="main" class="container hidden">
<div class="post" style="padding:15px;background:#444">
<textarea id="post-text" placeholder="Was gibt's Neues?"></textarea>
<button class="btn btn-green" onclick="createPost()">POSTEN</button>
</div>
<div id="feed"></div>
</div>

<script>
let isLoginMode=true,currentUser=null;
let users=JSON.parse(localStorage.getItem("cn_users")||"{}");
let posts=JSON.parse(localStorage.getItem("cn_posts")||[]);
let friendRequests=JSON.parse(localStorage.getItem("cn_friendRequests")||"{}");

const el=id=>document.getElementById(id);
const save=()=>{localStorage.setItem("cn_users",JSON.stringify(users));localStorage.setItem("cn_posts",JSON.stringify(posts));localStorage.setItem("cn_friendRequests",JSON.stringify(friendRequests));}

/* AUTH */
function toggleAuthMode(){
    isLoginMode=!isLoginMode;
    el("auth-skin").classList.toggle("hidden",isLoginMode);
    el("toggle-auth").innerText=isLoginMode?"Noch kein Account? Registrieren":"Bereits ein Account? Login";
    el("auth-error").classList.add("hidden");
}
function showError(m){
    el("auth-error").innerText=m;
    el("auth-error").classList.remove("hidden");
}
function handleAuth(){
    const n=el("auth-user").value.trim();
    const p=el("auth-pass").value;
    const s=el("auth-skin").value.trim();

    if(!n||p.length<4) return showError("Name & Passwort n√∂tig!");

    if(isLoginMode){
        if(users[n] && users[n].pass===p){
            loginUser(n);
        } else showError("Falsche Daten!");
    } else {
        if(users[n]) return showError("Name vergeben!");
        users[n]={pass:p,skin:s.includes("http")?s:`https://minotar.net/avatar/${s||n}`,friends:[]};
        save();
        toggleAuthMode();
        alert("Registriert! Jetzt einloggen.");
    }
}
function loginUser(n){
    currentUser=n;
    el("auth-error").classList.add("hidden");
    el("auth-modal").classList.add("hidden");
    el("main").classList.remove("hidden");
    el("nav-info").classList.remove("hidden");
    el("nav-name").innerText=n;
    el("nav-avatar").src=users[n].skin;
    renderFeed();
}

/* POSTS */
function createPost(){
    const t=el("post-text").value.trim();
    if(!t) return;
    posts.unshift({id:Date.now(),author:currentUser,text:t,likes:[],comments:[]});
    el("post-text").value="";
    save();renderFeed();
}
function likePost(id){
    const p=posts.find(x=>x.id===id);
    if(!p.likes.includes(currentUser)) p.likes.push(currentUser);
    save();renderFeed();
}
function addComment(id){
    const m=prompt("Kommentar:");
    if(!m) return;
    posts.find(p=>p.id===id).comments.push({u:currentUser,t:m});
    save();renderFeed();
}

/* FEED */
function renderFeed(){
    el("feed").innerHTML="";
    posts.forEach(p=>{
        el("feed").innerHTML+=`
        <div class="post">
        <div class="post-header">
            <img class="avatar" src="${users[p.author].skin}">
            <b class="username" onclick="showProfile('${p.author}')">${p.author}</b>
        </div>
        <div class="post-body">${p.text}</div>
        <div class="post-footer">
            <span onclick="likePost(${p.id})">‚õèÔ∏è ${p.likes.length}</span>
            <span onclick="addComment(${p.id})">üí¨ ${p.comments.length}</span>
        </div>
        <div class="comment-box">
            ${p.comments.map(c=>`<div><b>${c.u}:</b> ${c.t}</div>`).join("")}
        </div>
        </div>`;
    });
}

/* PROFILE */
function showProfile(u){
    el("feed").innerHTML=`
    <div class="profile">
    <img src="${users[u].skin}">
    <h2>${u}</h2>
    <button class="btn" onclick="renderFeed()">‚¨Ö Zur√ºck</button>
    </div>`;
}

/* MENU */
function openMainMenu(){
    el("feed").innerHTML=`
    <div class="post" style="padding:15px">
    <h3>üìã Men√º</h3>
    <button class="btn btn-green" onclick="renderFeed()">üì∞ Feed</button>
    <button class="btn" onclick="showProfile('${currentUser}')">üë§ Profil</button>
    <button class="btn" onclick="logout()">üö™ Logout</button>
    </div>`;
}
function logout(){
    currentUser=null;
    el("main").classList.add("hidden");
    el("auth-modal").classList.remove("hidden");
    el("nav-info").classList.add("hidden");
}
</script>

</body>
</html>
